<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω ƒê∆°n t·ª´ T·ªïng th·ªÉ</title>
    <!-- S·ª≠ d·ª•ng l·∫°i CSS c·ªßa Dashboard Admin -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dbadmin.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        /* T·ªëi ∆∞u h√≥a cho trang Qu·∫£n l√Ω ƒë∆°n */
        .container {
            padding-top: 20px;
            padding-bottom: 20px;
        }
        .badge-warning { background-color: #ffc107; color: #333; }
        .badge-success { background-color: #28a745; color: white; }
        .badge-danger { background-color: #dc3545; color: white; }
        .badge-secondary { background-color: #6c757d; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìÑ Qu·∫£n l√Ω ƒê∆°n t·ª´ T·ªïng th·ªÉ</h1>

        <!-- Form T√¨m ki·∫øm v√† L·ªçc Ph√≤ng ban -->
        <form method="GET" class="mt-4">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <div class="input-group">
                        <input type="text" name="search" class="form-control" placeholder="T√¨m ki·∫øm t√™n, m√£ NV..." 
                               value="{{ search_query or '' }}">
                        <div class="input-group-append">
                            <button class="btn btn-primary" type="submit">T√¨m ki·∫øm</button>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 mb-3">
                    <select name="phong_ban_filter" class="form-control">
                        <option value="">‚Äî L·ªçc theo Ph√≤ng ban ‚Äî</option>
                        {% for p in phong_bans %}
                            <option value="{{ p }}" 
                                    {% if p == request.args.get('phong_ban_filter') %}selected{% endif %}>
                                {{ p }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="col-md-4 mb-3">
                    <select name="trang_thai_filter" class="form-control" onchange="this.form.submit()">
                        <option value="">‚Äî L·ªçc theo Tr·∫°ng th√°i ‚Äî</option>
                        
                        {% set current_status = request.args.get('trang_thai_filter') %}
                        
                        <option value="ch·ªù duy·ªát" {% if current_status == 'ch·ªù duy·ªát' %}selected{% endif %}>Ch·ªù duy·ªát</option>
                        <option value="ƒë√£ duy·ªát" {% if current_status == 'ƒë√£ duy·ªát' %}selected{% endif %}>ƒê√£ duy·ªát</option>
                        <option value="t·ª´ ch·ªëi" {% if current_status == 't·ª´ ch·ªëi' %}selected{% endif %}>T·ª´ ch·ªëi</option>
                        <option value="ho√†n t·∫•t" {% if current_status == 'ho√†n t·∫•t' %}selected{% endif %}>Ho√†n t·∫•t</option>
                    </select>
                </div>
            </div>
        </form>
        <!-- B·∫£ng ƒë∆°n -->
        <table class="table table-striped mt-4">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ng∆∞·ªùi n·ªôp</th>
                    <th>M√£ NV</th>
                    <th>Ph√≤ng ban</th>
                    <th>Lo·∫°i ƒë∆°n</th>
                    <th>Tr·∫°ng th√°i</th>
                    <th>Ng√†y n·ªôp</th>
                    <th>Chi ti·∫øt</th>
                </tr>
            </thead>
            <tbody>
                {% for d in dons %}
                <tr>
                    <td>{{ d.id }}</td>
                    <td>{{ d.ho_ten }}</td>
                    <td>{{ d.ma_nv or 'N/A' }}</td>
                    <td>{{ d.phong_ban }}</td>
                    <td>{{ d.loai_don }}</td>
                    <td>
                        <!-- Th√™m m√†u s·∫Øc cho tr·∫°ng th√°i -->
                        {% set status = d.trang_thai|lower %}
                        {% if 'ch·ªù duy·ªát' in status %}
                            <span class="badge badge-warning">Ch·ªù duy·ªát</span>
                        {% elif 'ƒë√£ duy·ªát' in status or 'ho√†n t·∫•t' in status %}
                            <span class="badge badge-success">ƒê√£ duy·ªát</span>
                        {% elif 't·ª´ ch·ªëi' in status %}
                            <span class="badge badge-danger">T·ª´ ch·ªëi</span>
                        {% else %}
                            <span class="badge badge-secondary">{{ d.trang_thai }}</span>
                        {% endif %}
                    </td>
                    <!-- ƒê·ªãnh d·∫°ng l·∫°i ng√†y th√°ng (ch·ªâ l·∫•y ng√†y) -->
                    <td>{{ d.ngay_gui.split(' ')[0] if d.ngay_gui else 'N/A' }}</td> 
                    <td><a href="{{ url_for('don_detail', don_id=d.id) }}" class="btn btn-info btn-sm">Xem</a></td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-center text-muted">Kh√¥ng c√≥ ƒë∆°n n√†o ph√π h·ª£p v·ªõi t√¨m ki·∫øm.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <br>
        <a href="{{ url_for('dashboard_duyet') }}" class="btn btn-secondary">‚Üê Tr·ªü v·ªÅ Dashboard</a>
    </div>
</body>
</html>