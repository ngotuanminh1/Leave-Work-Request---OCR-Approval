<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω nh√¢n vi√™n</title>
    <style>
        /* CSS Tinh ch·ªânh ƒë·ªÉ hi·ªán ƒë·∫°i v√† chuy√™n nghi·ªáp */
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 30px; 
            background-color: #f4f7f9; 
            color: #333; 
        }
        h1 { 
            color: #1a73e8; 
            margin-bottom: 25px; 
            border-bottom: 2px solid #e9ecef; 
            padding-bottom: 10px; 
            font-weight: 600; 
        }
        
        /* B·∫£ng */
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
            background-color: white; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            border-radius: 8px; 
            overflow: hidden; 
        }
        th, td { 
            border: 1px solid #eee; 
            padding: 12px 15px; 
            text-align: left; 
        }
        th { 
            background: #e8f0fe; 
            color: #1a73e8; 
            font-weight: 700; 
            text-transform: uppercase; 
            font-size: 0.9em; 
        }
        
        /* Containers v√† Buttons */
        .btn-add-container { margin-bottom: 20px; }
        .btn { 
            padding: 8px 14px; 
            border: none; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 0.9em; 
            transition: background-color 0.2s, box-shadow 0.2s; 
            text-decoration: none; 
            display: inline-block; 
        }
        
        /* Th√™m */
        .btn-add { background: #34a853; color: white; }
        .btn-add:hover { background: #2b8e44; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        
        /* S·ª≠a */
        .btn-edit { background: #1a73e8; color: white; margin-right: 5px; }
        .btn-edit:hover { background: #0c59b2; }
        
        /* X√≥a */
        .btn-delete { background: #dc3545; color: white; }
        .btn-delete:hover { background: #c0392b; }

        /* CƒÉn ch·ªânh c·ªôt H√†nh ƒë·ªông */
        td:last-child {
            white-space: nowrap;
            width: 1%;
        }
    </style>
</head>
<body>
    <h1>üë• Qu·∫£n l√Ω nh√¢n vi√™n</h1>

    {% if role == "giam_doc" or role == "quan_ly" %}
        <div class="btn-add-container">
            <a href="{{ url_for('them_nhan_vien') }}" class="btn btn-add">+ Th√™m nh√¢n vi√™n</a>
        </div>
    {% endif %}

    {% if nhanviens|length > 0 %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>T√™n nh√¢n vi√™n</th>
                <th>Ph√≤ng ban</th>
                <th>Ch·ª©c v·ª•</th>
                <th>Email</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
    {% for nv in nhanviens %}
    <tr>
        <td>{{ nv.id }}</td>
        <td>{{ nv.ho_ten or nv.username }}</td>
        <td>{{ nv.phong_ban }}</td>
        <td>{{ nv.chuc_vu or nv.role }}</td>
        <td>{{ nv.email or 'N/A' }}</td> 
        <td>
            {% if role in ["giam_doc", "quan_ly"] %}
                <a href="{{ url_for('sua_nhan_vien', nv_id=nv.id) }}" class="btn btn-edit">S·ª≠a</a>
                
                <button class="btn btn-delete" 
                        data-id="{{ nv.id }}" 
                        data-name="{{ nv.ho_ten or nv.username }}">X√≥a</button>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
    </tbody>
    </table>
    {% else %}
        <p><i>Kh√¥ng c√≥ nh√¢n vi√™n n√†o ƒë·ªÉ hi·ªÉn th·ªã.</i></p>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const tableBody = document.querySelector('table tbody');
            
            if (tableBody) {
                // L·∫Øng nghe s·ª± ki·ªán click tr√™n to√†n b·ªô b·∫£ng
                tableBody.addEventListener('click', (e) => {
                    // Ki·ªÉm tra xem n√∫t ƒë∆∞·ª£c click c√≥ ph·∫£i l√† n√∫t x√≥a kh√¥ng
                    const deleteButton = e.target.closest('.btn-delete');
                    
                    if (deleteButton) {
                        // ƒê·ªçc d·ªØ li·ªáu t·ª´ data attributes
                        const id = deleteButton.dataset.id;
                        const name = deleteButton.dataset.name;
                        
                        if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√¢n vi√™n ${name} (ID: ${id}) kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`)) {
                            // T·∫°o v√† g·ª≠i form POST an to√†n
                            const form = document.createElement('form');
                            form.method = 'POST';
                            // Thi·∫øt l·∫≠p action (thay th·∫ø placeholder b·∫±ng ID th·ª±c t·∫ø)
                            // S·ª≠ d·ª•ng logic URL ƒë√£ ƒë∆∞·ª£c ch·ª©ng minh l√† an to√†n trong Flask
                            form.action = "{{ url_for('xoa_nhan_vien', nv_id=99999) }}".replace('99999', id);
                            
                            document.body.appendChild(form);
                            form.submit();
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>